syntax = "proto3";

package voiceplatform.v1;

import "common.proto";

option go_package = "github.com/yourorg/voiceplatform/proto/gen/go/voiceplatform/v1;voiceplatformv1";

// ── Attachments ────────────────────────────────────────────────────────

message AttachmentRef {
  AssetId asset_id = 1;
  string filename = 2;
  string mime_type = 3;
  uint64 size_bytes = 4;

  // Optional preview metadata.
  uint32 width = 5;
  uint32 height = 6;
  uint64 duration_ms = 7; // for audio/video

  // URLs (populated by server after upload completes)
  string download_url = 8;
  string thumbnail_url = 9;
}

// ── Reactions ──────────────────────────────────────────────────────────

message Reaction {
  string emoji = 1;          // unicode emoji or custom emoji ID
  uint32 count = 2;
  repeated UserId users = 3; // first few users who reacted
  bool me = 4;               // whether current user reacted with this
}

// ── Messages ───────────────────────────────────────────────────────────

message SendMessageRequest {
  ChannelId channel_id = 1;
  string text = 2;                          // markdown-formatted text
  repeated AttachmentRef attachments = 3;
  MessageId reply_to_message_id = 4;        // optional: threading
  repeated UserId mentions = 5;             // explicitly mentioned users
}

message EditMessageRequest {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
  string new_text = 3;
}

message EditMessageResponse {
  MessageId message_id = 1;
}

message DeleteMessageRequest {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
}

message DeleteMessageResponse {}

message AddReactionRequest {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
  string emoji = 3;
}

message AddReactionResponse {}

message RemoveReactionRequest {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
  string emoji = 3;
}

message RemoveReactionResponse {}

message PinMessageRequest {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
}

message PinMessageResponse {}

message UnpinMessageRequest {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
}

message UnpinMessageResponse {}

// ── Events ─────────────────────────────────────────────────────────────

message ChatEvent {
  Timestamp at = 1;

  oneof kind {
    MessagePosted message_posted = 10;
    MessageEdited message_edited = 11;
    MessageDeleted message_deleted = 12;
    ReactionAdded reaction_added = 13;
    ReactionRemoved reaction_removed = 14;
    MessagePinned message_pinned = 15;
    MessageUnpinned message_unpinned = 16;
    TypingStarted typing_started = 17;
  }
}

message MessagePosted {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
  UserId author_user_id = 3;
  string text = 4;                          // markdown
  repeated AttachmentRef attachments = 5;
  MessageId reply_to_message_id = 6;        // threading
  repeated UserId mentions = 7;
  Timestamp edited_at = 8;                  // set if message was edited
  bool pinned = 9;
  repeated Reaction reactions = 10;
}

message MessageEdited {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
  string new_text = 3;
  Timestamp edited_at = 4;
}

message MessageDeleted {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
}

message ReactionAdded {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
  UserId user_id = 3;
  string emoji = 4;
}

message ReactionRemoved {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
  UserId user_id = 3;
  string emoji = 4;
}

message MessagePinned {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
  UserId actor_user_id = 3;
}

message MessageUnpinned {
  MessageId message_id = 1;
  ChannelId channel_id = 2;
  UserId actor_user_id = 3;
}

message TypingStarted {
  ChannelId channel_id = 1;
  UserId user_id = 2;
}

// ── Typing indicator request ───────────────────────────────────────────

message SendTypingRequest {
  ChannelId channel_id = 1;
}

message SendTypingResponse {}
